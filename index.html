<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Winter Simulator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <style>
        * {
            cursor: none !important;
        }
        img {
            user-select: none;
            -webkit-user-drag: none;
            -moz-user-select: none;
            -ms-user-select: none;
            pointer-events: auto;
        }
        body {
            background-color: lightblue;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }
        .custom-cursor {
            position: fixed;
            width: 68px;
            height: auto;
            pointer-events: none;
            z-index: 10003;
            transform: translate(-50%, -50%);
            image-rendering: pixelated;
        }
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .left-sidebar {
            width: 600px;
            background-color: rgba(255, 255, 255, 0.1);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
            flex-direction: column;
            justify-content: flex-start;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        .left-sidebar::-webkit-scrollbar {
            width: 8px;
        }
        .left-sidebar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        .left-sidebar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }
        .left-sidebar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        .left-sidebar.visible {
            display: flex;
        }
        .right-sidebar {
            width: 300px;
            background-color: rgba(255, 255, 255, 0.1);
            border-left: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding: 20px;
            box-sizing: border-box;
        }
        .upgrades {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        .upgrade {
            background-color: black;
            padding: 12px;
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .upgrade#golden-mitten-upgrade {
            margin-top: 24px;
        }
        .upgrade#golden-snowman-upgrade {
            margin-top: 24px;
        }
        .upgrade#random-buff-upgrade {
            margin-top: 24px;
        }
        .upgrade-content {
            flex: 1;
        }
        .upgrade-image {
            width: 40px;
            height: 40px;
            object-fit: contain;
            margin-left: 12px;
        }
        .upgrade:hover:not(.purchased) {
            transform: translateY(-2px);
        }
        .upgrade.purchased {
            opacity: 0.5;
        }
        .upgrade.disabled {
            opacity: 0.5;
        }
        .upgrade-title {
            font-size: 16px;
            margin-bottom: 4px;
        }
        .upgrade-cost {
            font-size: 12px;
            opacity: 0.8;
        }
        .counter {
            font-family: 'Montserrat', sans-serif;
            font-size: 48px;
            font-weight: 700;
            color: white;
            margin-bottom: 20px;
            z-index: 2;
            letter-spacing: 2px;
        }
        .snowball {
            width: 360px;
            height: auto;
            position: relative;
            z-index: 1;
            transition: transform 0.1s ease-out;
        }
        .snowball.clicked {
            animation: snowballBounce 0.3s ease-out;
        }
        .snowball.crack {
            animation: snowballCrack 2s ease-out forwards;
        }
        body.crack-shake {
            animation: screenShake 2s ease-out forwards;
        }
        .crack-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
        .crack-particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(255, 255, 255, 1);
            opacity: 0;
        }
        @keyframes snowballBounce {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(0.95);
            }
            100% {
                transform: scale(1);
            }
        }
        @keyframes snowballCrack {
            0% {
                transform: scale(1) rotate(0deg);
                filter: brightness(1) contrast(1);
            }
            20% {
                transform: scale(1.05) rotate(3deg);
                filter: brightness(1.1) contrast(1.1);
            }
            40% {
                transform: scale(0.95) rotate(-5deg);
                filter: brightness(0.7) contrast(1.3);
            }
            60% {
                transform: scale(0.92) rotate(4deg);
                filter: brightness(0.5) contrast(1.5);
            }
            80% {
                transform: scale(0.88) rotate(-3deg);
                filter: brightness(0.4) contrast(1.7);
            }
            100% {
                transform: scale(0.85) rotate(0deg);
                filter: brightness(0.3) contrast(2);
            }
        }
        @keyframes screenShake {
            0%, 100% {
                transform: translate(0, 0);
            }
            10% {
                transform: translate(-2px, -1px) rotate(0.5deg);
            }
            20% {
                transform: translate(2px, 1px) rotate(-0.5deg);
            }
            30% {
                transform: translate(-3px, -2px) rotate(0.8deg);
            }
            40% {
                transform: translate(3px, 2px) rotate(-0.8deg);
            }
            50% {
                transform: translate(-4px, -3px) rotate(1deg);
            }
            60% {
                transform: translate(4px, 3px) rotate(-1deg);
            }
            70% {
                transform: translate(-3px, -2px) rotate(0.8deg);
            }
            80% {
                transform: translate(3px, 2px) rotate(-0.8deg);
            }
            90% {
                transform: translate(-1px, -1px) rotate(0.3deg);
            }
        }
        
        .mitten {
            position: absolute;
            width: 80px;
            height: auto;
            pointer-events: none;
            z-index: 2;
            top: 50%;
            left: 50%;
            margin-left: -40px;
            margin-top: -40px;
            animation: orbit 3s linear infinite;
        }
        @keyframes orbit {
            0% {
                transform: rotate(0deg) translateX(200px) rotate(0deg);
            }
            25% {
                transform: rotate(90deg) translateX(200px) rotate(90deg);
            }
            50% {
                transform: rotate(180deg) translateX(200px) rotate(180deg);
            }
            75% {
                transform: rotate(270deg) translateX(200px) rotate(270deg);
            }
            100% {
                transform: rotate(360deg) translateX(200px) rotate(360deg);
            }
        }
        
        .snowflake {
            position: absolute;
            width: 120px;
            height: 120px;
            pointer-events: none;
            animation: fall linear forwards;
            z-index: 0;
        }
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        .snowman-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        .snowman-section-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 18px;
            color: white;
            margin-bottom: 15px;
            background-color: black;
            padding: 12px;
            display: block;
            width: 100%;
            box-sizing: border-box;
        }
        .snowmen-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .snowman-visual {
            width: 80px;
            height: auto;
        }
        .hot-chocolate-visual {
            width: 160px;
            height: auto;
        }
        .snowbank-visual {
            width: 320px;
            height: auto;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            margin-left: 50%;
            transform: translateX(-50%);
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        .snowbank-visual:hover {
            transform: translateX(-50%) scale(1.2);
        }
        .snowman-visual img, .hot-chocolate-visual img, .snowbank-visual img {
            width: 100%;
            height: auto;
            display: block;
        }
        .achievement-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            pointer-events: none;
        }
        .achievement {
            background-color: black;
            color: white;
            font-family: 'Montserrat', sans-serif;
            padding: 16px 24px;
            margin-bottom: 10px;
            border-radius: 4px;
            opacity: 1;
            transition: opacity 0.5s ease-out;
            min-width: 300px;
            text-align: center;
        }
        .achievement.fade-out {
            opacity: 0;
        }
        .achievement-title {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 4px;
        }
        .achievement-description {
            font-size: 14px;
            opacity: 0.8;
        }
        .achievements-button {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10001;
            background-color: black;
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            pointer-events: auto;
            display: none;
        }
        .achievements-button.visible {
            display: block;
        }
        .achievements-popover {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10002;
            background-color: black;
            color: white;
            font-family: 'Montserrat', sans-serif;
            width: 400px;
            max-height: 500px;
            border-radius: 4px;
            padding: 20px;
            box-sizing: border-box;
            display: none;
            flex-direction: column;
            pointer-events: auto;
        }
        .achievements-popover.visible {
            display: flex;
        }
        .achievements-popover-header {
            font-weight: 700;
            font-size: 20px;
            margin-bottom: 16px;
        }
        .achievements-search {
            width: 100%;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            margin-bottom: 16px;
            box-sizing: border-box;
        }
        .achievements-search::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        .achievements-list {
            overflow-y: auto;
            flex: 1;
        }
        .achievement-item {
            padding: 12px;
            margin-bottom: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        .achievement-item-title {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 4px;
        }
        .achievement-item-description {
            font-size: 14px;
            opacity: 0.8;
        }
        .rebirth-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10001;
            background-color: black;
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            pointer-events: auto;
            display: none;
        }
        .rebirth-button.visible {
            display: block;
        }
        .cookies-display {
            background-color: black;
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            padding: 12px 24px;
            border-radius: 4px;
            pointer-events: auto;
            display: none;
            margin-top: auto;
        }
        .cookies-display.visible {
            display: block;
        }
        .cookies-display-title {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 4px;
        }
        .cookies-display-count {
            font-size: 24px;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltip-text {
            visibility: hidden;
            background-color: black;
            color: white;
            text-align: center;
            border-radius: 4px;
            padding: 8px 12px;
            position: absolute;
            z-index: 10001;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            font-weight: 700;
            white-space: nowrap;
        }
        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 5px;
            border-style: solid;
            border-color: black transparent transparent transparent;
        }
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .rebirth-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10002;
            background-color: black;
            color: white;
            font-family: 'Montserrat', sans-serif;
            width: 400px;
            border-radius: 4px;
            padding: 24px;
            box-sizing: border-box;
            display: none;
            flex-direction: column;
            pointer-events: auto;
        }
        .rebirth-modal.visible {
            display: flex;
        }
        .rebirth-modal-header {
            font-weight: 700;
            font-size: 24px;
            margin-bottom: 16px;
        }
        .rebirth-modal-content {
            font-size: 16px;
            margin-bottom: 24px;
            opacity: 0.9;
            line-height: 1.5;
        }
        .rebirth-modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        .rebirth-modal-button {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            padding: 10px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .rebirth-modal-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        .rebirth-modal-button.confirm {
            background-color: rgba(255, 0, 0, 0.3);
            border-color: rgba(255, 0, 0, 0.5);
        }
        .rebirth-modal-button.confirm:hover {
            background-color: rgba(255, 0, 0, 0.4);
        }
        .rebirth-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 10001;
            display: none;
            pointer-events: auto;
        }
        .rebirth-modal-overlay.visible {
            display: block;
        }
        .trade-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 10001;
            display: none;
            pointer-events: auto;
        }
        .trade-modal-overlay.visible {
            display: block;
        }
        .trade-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10002;
            background-color: black;
            color: white;
            font-family: 'Montserrat', sans-serif;
            width: 400px;
            border-radius: 4px;
            padding: 24px;
            box-sizing: border-box;
            display: none;
            flex-direction: column;
            pointer-events: auto;
        }
        .trade-modal.visible {
            display: flex;
        }
        .trade-modal-header {
            font-weight: 700;
            font-size: 24px;
            margin-bottom: 16px;
        }
        .trade-modal-content {
            font-size: 16px;
            margin-bottom: 24px;
            opacity: 0.9;
            line-height: 1.5;
            min-height: 100px;
        }
        .trade-modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        .trade-modal-button {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;ß
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            padding: 10px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .trade-modal-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        .trade-button {
            width: auto;
            background-color: black;
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            pointer-events: auto;
            margin-top: 15px;
            transition: all 0.2s;
        }
        .trade-button:hover {
            transform: translateY(-2px);
        }
        .stock-price {
            font-size: 48px;
            font-weight: 700;
            color: white;
            text-align: center;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .price-change {
            font-size: 16px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        .price-change.positive {
            background-color: rgba(0, 255, 0, 0.2);
            color: #00ff00;
        }
        .price-change.negative {
            background-color: rgba(255, 0, 0, 0.2);
            color: #ff4444;
        }
        .stock-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        .stock-owned, .stock-value {
            font-size: 16px;
            font-weight: 700;
            color: white;
        }
        .trading-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }
        .buy-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .buy-controls input {
            width: 80px;
            padding: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            text-align: center;
        }
        .buy-controls input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        .buy-button, .sell-button {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            padding: 12px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 100px;
        }
        .buy-button:hover:not(:disabled), .sell-button:hover:not(:disabled) {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        .buy-button:disabled, .sell-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .trading-timer {
            text-align: center;
            font-size: 18px;
            font-weight: 700;
            color: white;
            margin: 15px 0;
            opacity: 0.9;
        }
        .sell-options {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        .sell-option {
            background-color: rgba(255, 0, 0, 0.2);
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            padding: 8px 16px;
            border: 1px solid rgba(255, 0, 0, 0.3);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .sell-option:hover:not(:disabled) {
            background-color: rgba(255, 0, 0, 0.3);
            transform: translateY(-2px);
        }
        .sell-option:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
    </style>
</head>
<body>
    <div class="left-sidebar">
        <div class="snowman-section">
            <div class="snowman-section-title">Snowmen</div>
            <div class="snowmen-container" id="snowmen-container">
            </div>
        </div>
        <div class="snowman-section" id="gingerbread-section" style="display: none;">
            <div class="snowman-section-title">Gingerbread Men</div>
            <div class="snowmen-container" id="gingerbread-container">
            </div>
        </div>
        <div class="snowman-section" id="gingerbreadhouse-section" style="display: none;">
            <div class="snowman-section-title">Gingerbread Houses</div>
            <div class="snowmen-container" id="gingerbreadhouse-container">
            </div>
        </div>
        <div class="snowman-section" id="hotchocolate-section" style="display: none;">
            <div class="snowman-section-title">Hot Chocolate Cups</div>
            <div class="snowmen-container" id="hotchocolate-container">
            </div>
        </div>
        <div class="snowman-section" id="snowbank-section" style="display: none;">
            <div class="snowman-section-title">Snow Bank</div>
            <div class="snowmen-container" id="snowbank-container">
            </div>
            <button class="trade-button" id="trade-button" style="display: none;">Tap to Trade</button>
        </div>
        <div class="cookies-display" id="cookies-display">
            <div class="cookies-display-title">Gingerbread Cookies:</div>
            <div class="cookies-display-count" id="cookies-count">0</div>
        </div>
    </div>
    <div class="main-content">
        <div class="counter" id="counter">0</div>
        <div style="position: relative; display: inline-block;" id="snowball-container">
            <img src="snow.png" alt="Snowball" class="snowball">
        </div>
    </div>
    <div class="right-sidebar">
        <div class="upgrades">
            <div class="upgrade" id="mitten-upgrade">
                <div class="upgrade-content">
                    <div class="upgrade-title">Mitten</div>
                    <div class="upgrade-cost" id="mitten-cost">Cost: 10</div>
                </div>
            </div>
            <div class="upgrade" id="snowman-upgrade">
                <div class="upgrade-content">
                    <div class="upgrade-title">Snowman</div>
                    <div class="upgrade-cost" id="snowman-cost">Cost: 50</div>
                </div>
            </div>
            <div class="upgrade" id="gingerbread-upgrade" style="display: none;">
                <div class="upgrade-content">
                    <div class="upgrade-title">Gingerbread Man</div>
                    <div class="upgrade-cost" id="gingerbread-cost">Cost: 250</div>
                </div>
            </div>
            <div class="upgrade" id="gingerbreadhouse-upgrade" style="display: none;">
                <div class="upgrade-content">
                    <div class="upgrade-title">Gingerbread House</div>
                    <div class="upgrade-cost" id="gingerbreadhouse-cost">Cost: 1000</div>
                </div>
            </div>
            <div class="upgrade" id="hotchocolate-upgrade" style="display: none;">
                <div class="upgrade-content">
                    <div class="upgrade-title">Hot Chocolate Cup</div>
                    <div class="upgrade-cost" id="hotchocolate-cost">Cost: 2500</div>
                </div>
            </div>
            <div class="upgrade" id="snowbank-upgrade" style="display: none;">
                    <div class="upgrade-title">Snow Bank</div>
                    <div class="upgrade-cost" id="snowbank-cost">Cost: 10000</div>
                </div>
            </div>
            <div class="upgrade" id="golden-mitten-upgrade" style="display: none;">
                <div class="upgrade-content">
                    <div class="upgrade-title">Golden Mitten</div>
                    <div class="upgrade-cost" id="golden-mitten-cost">Cost: 1 Gingerbread Cookie</div>
                </div>
                <img src="golden_mitten.png" alt="Golden Mitten" class="upgrade-image">
            </div>
            <div class="upgrade" id="golden-snowman-upgrade" style="display: none;">
                <div class="upgrade-content">
                    <div class="upgrade-title">Golden Snowman</div>
                    <div class="upgrade-cost" id="golden-snowman-cost">Cost: 3 Gingerbread Cookies</div>
                </div>
                <img src="golden_snowman.png" alt="Golden Snowman" class="upgrade-image">
            </div>
            <div class="upgrade" id="random-buff-upgrade" style="display: none;">
                <div class="upgrade-content">
                    <div class="upgrade-title">Random Buff</div>
                    <div class="upgrade-cost" id="random-buff-cost">Cost: 5 Gingerbread Cookies</div>
                </div>
                <img src="strength.png" alt="Random Buff" class="upgrade-image">
            </div>
        </div>
    </div>
    <img src="cursor.webp" alt="" class="custom-cursor" id="customCursor">
    <div class="achievement-container" id="achievement-container"></div>
    <div class="crack-particles" id="crack-particles"></div>
    <button class="achievements-button" id="achievements-button">Achievements</button>
    <button class="rebirth-button" id="rebirth-button">Rebirth</button>
    <div class="rebirth-modal-overlay" id="rebirth-modal-overlay"></div>
    <div class="rebirth-modal" id="rebirth-modal">
        <div class="rebirth-modal-header">Rebirth</div>
        <div class="rebirth-modal-content">
            You will lose all snow and upgrades but earn gingerbread cookies.
        </div>
        <div class="rebirth-modal-actions">
            <button class="rebirth-modal-button" id="rebirth-cancel">Cancel</button>
            <button class="rebirth-modal-button confirm" id="rebirth-confirm">Rebirth</button>
        </div>
    </div>
    <div class="trade-modal-overlay" id="trade-modal-overlay"></div>
    <div class="trade-modal" id="trade-modal">
        <div class="trade-modal-header">❄️ $SNOW Stock Exchange ❄️</div>
        <div class="trade-modal-content">
            <div class="stock-price" id="stock-price">$1.00<span id="price-change" class="price-change"></span></div>
            <div class="stock-info">
                <div class="stock-owned">Owned: <span id="owned-stocks">0</span></div>
                <div class="stock-value">Value: $<span id="portfolio-value">0.00</span></div>
            </div>
            <div class="trading-timer" id="trading-timer">Buy your first $SNOW stock to start the winter trading blizzard!</div>
            <div class="trading-controls">
                <div class="buy-controls">
                    <input type="number" id="buy-amount" min="1" value="1" placeholder="Amount">
                    <button class="buy-button" id="buy-stock">Buy $SNOW</button>
                </div>
            </div>
            <div class="sell-options">
                <button class="sell-option" id="sell-25">Sell 25%</button>
                <button class="sell-option" id="sell-50">Sell 50%</button>
                <button class="sell-option" id="sell-100">Sell 100%</button>
            </div>
        </div>
        <div class="trade-modal-actions">
            <button class="trade-modal-button" id="trade-close">Close</button>
        </div>
    </div>
    <div class="achievements-popover" id="achievements-popover">
        <div class="achievements-popover-header">Achievements</div>
        <input type="text" class="achievements-search" id="achievements-search" placeholder="Search achievements...">
        <div class="achievements-list" id="achievements-list"></div>
    </div>
    <script>
        document.querySelectorAll('img').forEach(img => {
            img.setAttribute('draggable', 'false');
        });
        const customCursor = document.getElementById('customCursor');
        let mouseX = 0;
        let mouseY = 0;
        let cursorX = 0;
        let cursorY = 0;
        
        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });
        
        function animateCursor() {
            cursorX += (mouseX - cursorX) * 0.1;
            cursorY += (mouseY - cursorY) * 0.1;
            customCursor.style.left = cursorX + 'px';
            customCursor.style.top = cursorY + 'px';
            requestAnimationFrame(animateCursor);
        }
        animateCursor();
        
        let clickCount = 0;
        let mittenCount = 0;
        let snowmanCount = 0;
        let hotChocolateCount = 0;
        let gingerbreadCount = 0;
        let gingerbreadHouseCount = 0;
        let snowBankPurchased = false;
        let autoClickInterval = null;
        let gingerbreadCookies = 0;
        let goldenMittenPurchased = false;
        let goldenSnowmanPurchased = false;
        let rightClickPressed = false;
        let mittenHistory = [];
        let activeSnowflakes = 0;
        let unlockedAchievements = new Set();
        let activeBuffs = {};
        let buffTimers = {};
        let rebirthMultiplier = 1;

        let stockPrice = 1.00;
        let ownedStocks = 0;
        let tradingSessionActive = false;
        let tradingSessionTime = 0;
        let stockPriceInterval = null;
        let tradingSessionInterval = null;
        let sessionStartTime = 0;
        let priceEverOver105 = false;
        let previousPrice = 1.00;
        const snowmanNames = [
            "Frosty", "Snowball", "Chilly", "Icicle", "Winter", "Blizzard",
            "Powder", "Glacier", "Snowflake", "Arctic", "Polar", "North"
        ];
        const gingerbreadNames = [
            "Cookie", "Ginger", "Spice", "Sweet", "Crunch", "Cinnamon",
            "Nutmeg", "Honey", "Sugar", "Dough", "Bake", "Frosting",
            "Crumble", "Chewy", "Soft", "Warm"
        ];
        const achievementData = {
            'getting_mittens': { title: 'Mitten Collector', description: 'Acquire your first mitten' },
            'out_of_hand': { title: 'Out of Hand', description: 'Build up 3 mittens' },
            'jolly_happy_soul': { title: 'Frosty Friend', description: 'Create your first snowman' },
            'snowmen': { title: 'Snowman Army', description: 'Build 2 snowmen' },
            'disappearing': { title: 'Winter Wonderland', description: 'Create 6 snowmen' },
            'house_please': { title: 'Sweet Treats', description: 'Bake your first gingerbread man' },
            'thanks_gingerbread_man': { title: 'Gingerbread Architect', description: 'Build your first gingerbread house' },
            'rebirths_unlocked': { title: 'Winter Rebirth', description: 'Gather 1000 snowballs to unlock rebirths' }
        };

        const buffData = {
            'double_earnings': {
                name: 'Earnings Blizzard',
                description: 'Double all earnings for 5 minutes of snowball frenzy!',
                duration: 300000, // 5 minutes in milliseconds
                probability: 20,
                type: 'earnings_multiplier',
                value: 2
            },
            'triple_earnings': {
                name: 'Triple Earnings Storm',
                description: 'Triple all earnings for 3 minutes of winter madness!',
                duration: 180000, // 3 minutes
                probability: 16,
                type: 'earnings_multiplier',
                value: 3
            },
            'half_off': {
                name: 'Winter Sale',
                description: 'All upgrades cost half price for 1 minute!',
                duration: 60000, // 1 minute
                probability: 4,
                type: 'cost_reduction',
                value: 0.5
            },
            'mitten_overload': {
                name: 'Mitten Mania',
                description: 'All mittens cost only 1 snowball each!',
                duration: -1, // Permanent until rebirth
                probability: 8,
                type: 'mitten_cost_override',
                value: 1
            },
            'double_rebirth': {
                name: 'Lucky Rebirth',
                description: 'Your next rebirth will give double gingerbread cookies!',
                duration: -1, // Until used
                probability: 8,
                type: 'rebirth_multiplier',
                value: 2
            },
            'triple_rebirth': {
                name: 'Mega Rebirth',
                description: 'Your next rebirth will give triple gingerbread cookies!',
                duration: -1, // Until used
                probability: 4,
                type: 'rebirth_multiplier',
                value: 3
            },
            'tap_frenzy': {
                name: 'Tap Frenzy',
                description: 'Each tap gives 50 snowballs for 3 minutes!',
                duration: 180000, // 3 minutes
                probability: 20,
                type: 'tap_bonus',
                value: 50
            },
            'ultra_tap_frenzy': {
                name: 'Ultra Tap Frenzy',
                description: 'Each tap gives 100 snowballs for 5 minutes!',
                duration: 300000, // 5 minutes
                probability: 12,
                type: 'tap_bonus',
                value: 100
            },
            'snowman_bonus': {
                name: 'Frosty Boost',
                description: 'Snowmen produce double earnings for 2 minutes!',
                duration: 120000, // 2 minutes
                probability: 4,
                type: 'snowman_multiplier',
                value: 2
            },
            'ultra_snowman_bonus': {
                name: 'Arctic Power',
                description: 'Snowmen produce triple earnings for 3 minutes!',
                duration: 180000, // 3 minutes
                probability: 4,
                type: 'snowman_multiplier',
                value: 3
            }
        };

        function selectRandomBuff() {
            const rand = Math.random() * 100;
            let cumulativeProbability = 0;

            for (const [buffId, buff] of Object.entries(buffData)) {
                cumulativeProbability += buff.probability;
                if (rand <= cumulativeProbability) {
                    return buffId;
                }
            }

            return 'double_earnings';
        }

        function activateBuff(buffId) {
            const buff = buffData[buffId];
            if (!buff) return;

            for (const [existingBuffId, existingBuff] of Object.entries(activeBuffs)) {
                if (existingBuff.type === buff.type) {
                    deactivateBuff(existingBuffId);
                }
            }

            activeBuffs[buffId] = buff;

            showAchievement(buff.name, buff.description);

            if (buff.duration > 0) {
                buffTimers[buffId] = setTimeout(() => {
                    deactivateBuff(buffId);
                }, buff.duration);
            } else if (buff.type === 'rebirth_multiplier') {
                rebirthMultiplier *= buff.value;
            }

            updateAutoClick();
            updateUpgradeDisplay();
        }

        function deactivateBuff(buffId) {
            if (activeBuffs[buffId]) {
                delete activeBuffs[buffId];
            }

            if (buffTimers[buffId]) {
                clearTimeout(buffTimers[buffId]);
                delete buffTimers[buffId];
            }

            updateAutoClick();
            updateUpgradeDisplay();
        }

        function getCurrentEarningsMultiplier() {
            let multiplier = 1;

            for (const buff of Object.values(activeBuffs)) {
                if (buff.type === 'earnings_multiplier') {
                    multiplier *= buff.value;
                }
            }

            return multiplier;
        }

        function getCurrentSnowmanMultiplier() {
            let multiplier = 1;

            for (const buff of Object.values(activeBuffs)) {
                if (buff.type === 'snowman_multiplier') {
                    multiplier *= buff.value;
                }
            }

            return multiplier;
        }

        function getCurrentTapBonus() {
            let bonus = 0;

            for (const buff of Object.values(activeBuffs)) {
                if (buff.type === 'tap_bonus') {
                    bonus = Math.max(bonus, buff.value); // Use the highest tap bonus
                }
            }

            return bonus;
        }

        function getCurrentCostMultiplier() {
            let multiplier = 1;

            for (const buff of Object.values(activeBuffs)) {
                if (buff.type === 'cost_reduction') {
                    multiplier *= buff.value;
                }
            }

            return multiplier;
        }

        function getMittenCostOverride() {
            for (const buff of Object.values(activeBuffs)) {
                if (buff.type === 'mitten_cost_override') {
                    return buff.value;
                }
            }

            return null;
        }
        const baseMittenCost = 10;
        const baseSnowmanCost = 50;
        const baseGingerbreadCost = 250;
        const baseGingerbreadHouseCost = 1000;
        const baseHotChocolateCost = 2500;
        const snowBankCost = 10000;
        const maxMittens = 32;
        const counterElement = document.getElementById('counter');
        const mittenUpgrade = document.getElementById('mitten-upgrade');
        const mittenCostElement = document.getElementById('mitten-cost');
        const snowmanUpgrade = document.getElementById('snowman-upgrade');
        const snowmanCostElement = document.getElementById('snowman-cost');
        const hotChocolateUpgrade = document.getElementById('hotchocolate-upgrade');
        const hotChocolateCostElement = document.getElementById('hotchocolate-cost');
        const snowBankUpgrade = document.getElementById('snowbank-upgrade');
        const snowBankCostElement = document.getElementById('snowbank-cost');
        const gingerbreadUpgrade = document.getElementById('gingerbread-upgrade');
        const gingerbreadCostElement = document.getElementById('gingerbread-cost');
        const gingerbreadHouseUpgrade = document.getElementById('gingerbreadhouse-upgrade');
        const gingerbreadHouseCostElement = document.getElementById('gingerbreadhouse-cost');
        const snowballContainer = document.getElementById('snowball-container');
        const snowball = document.querySelector('.snowball');

        const stockPriceElement = document.getElementById('stock-price');
        const ownedStocksElement = document.getElementById('owned-stocks');
        const portfolioValueElement = document.getElementById('portfolio-value');
        const tradingTimerElement = document.getElementById('trading-timer');
        const buyAmountInput = document.getElementById('buy-amount');
        const buyStockButton = document.getElementById('buy-stock');
        const sell25Button = document.getElementById('sell-25');
        const sell50Button = document.getElementById('sell-50');
        const sell100Button = document.getElementById('sell-100');
        
        function getMittenCost(count) {
            const overrideCost = getMittenCostOverride();
            if (overrideCost !== null) {
                return overrideCost;
            }

            if (count < 10) {
                return Math.ceil(baseMittenCost * Math.pow(1.05, count));
            } else if (count < 16) {
                const costAt9 = baseMittenCost * Math.pow(1.05, 9);
                return Math.ceil(costAt9 * Math.pow(1.1, count - 9));
            } else if (count < 32) {
                const costAt9 = baseMittenCost * Math.pow(1.05, 9);
                const costAt15 = costAt9 * Math.pow(1.1, 6);
                return Math.ceil(costAt15 * Math.pow(1.25, count - 15));
            }
            return Infinity;
        }
        
        function getSnowmanCost(count) {
            return Math.ceil(baseSnowmanCost * Math.pow(1.15, count));
        }
        
        function getHotChocolateCost(count) {
            return Math.ceil(baseHotChocolateCost * Math.pow(1.08, count));
        }
        
        function getGingerbreadCost(count) {
            return Math.ceil(baseGingerbreadCost * Math.pow(1.03, count));
        }
        
        function getGingerbreadHouseCost(count) {
            return Math.ceil(baseGingerbreadHouseCost * Math.pow(1.06, count));
        }
        
        function incrementClick() {
            let incrementAmount = 1;

            const tapBonus = getCurrentTapBonus();
            if (tapBonus > 0) {
                incrementAmount = tapBonus;
            }

            const earningsMultiplier = getCurrentEarningsMultiplier();
            incrementAmount *= earningsMultiplier;

            clickCount += incrementAmount;
            counterElement.textContent = clickCount;
            checkAchievements();
            
            if (activeSnowflakes < 50) {
                activeSnowflakes++;
                const snowflake = document.createElement('img');
                snowflake.src = 'snowflake.webp';
                snowflake.className = 'snowflake';
                snowflake.setAttribute('draggable', 'false');
                const leftSidebarWidth = 600;
                const rightSidebarWidth = 300;
                const minX = leftSidebarWidth;
                const maxX = window.innerWidth - rightSidebarWidth - 120;
                snowflake.style.left = Math.random() * (maxX - minX) + minX + 'px';
                snowflake.style.top = '-120px';
                snowflake.style.animationDuration = (Math.random() * 2 + 1) + 's';
                document.body.appendChild(snowflake);
                
                setTimeout(() => {
                    snowflake.remove();
                    activeSnowflakes--;
                }, 3000);
            }
        }
        
        function getVisibleMittenCount(total) {
            if (total <= 4) return total;
            if (total <= 8) return Math.ceil(total / 2);
            if (total <= 16) return Math.ceil(total / 4);
            if (total <= 32) return Math.ceil(total / 8);
            return 16; 
        }
        
        function updateMittenDisplay() {
            const visibleCount = getVisibleMittenCount(mittenCount);
            let mittens = snowballContainer.querySelectorAll('.mitten');
            
            while (mittens.length > visibleCount) {
                mittens[mittens.length - 1].remove();
                mittens = snowballContainer.querySelectorAll('.mitten');
            }
            
            while (mittens.length < visibleCount) {
                const mitten = document.createElement('img');
                mitten.setAttribute('draggable', 'false');
                let mittenType;
                if (mittenHistory.length >= 3 && 
                    mittenHistory[mittenHistory.length - 1] === mittenHistory[mittenHistory.length - 2] &&
                    mittenHistory[mittenHistory.length - 2] === mittenHistory[mittenHistory.length - 3]) {
                    mittenType = mittenHistory[mittenHistory.length - 1] === 'mitten.webp' ? 'mitten2.png' : 'mitten.webp';
                } else {
                    mittenType = Math.random() < 0.5 ? 'mitten.webp' : 'mitten2.png';
                }
                mitten.src = mittenType;
                mittenHistory.push(mittenType);
                if (mittenHistory.length > 3) {
                    mittenHistory.shift();
                }
                mitten.className = 'mitten';
                mitten.style.animationDelay = (mittens.length * 0.5) + 's';
                snowballContainer.appendChild(mitten);
                mittens = snowballContainer.querySelectorAll('.mitten');
            }
        }
        
        function showAchievement(title, description) {
            const container = document.getElementById('achievement-container');
            const achievement = document.createElement('div');
            achievement.className = 'achievement';
            achievement.innerHTML = `
                <div class="achievement-title">${title}</div>
                <div class="achievement-description">${description}</div>
            `;
            container.appendChild(achievement);
            updateAchievementsButton();
            
            setTimeout(() => {
                achievement.classList.add('fade-out');
                setTimeout(() => {
                    achievement.remove();
                    updateAchievementsButton();
                }, 500);
            }, 3000);
        }
        
        function updateAchievementsButton() {
            const container = document.getElementById('achievement-container');
            const button = document.getElementById('achievements-button');
            if (container.children.length > 0) {
                button.classList.remove('visible');
            } else {
                button.classList.add('visible');
            }
        }
        
        function renderAchievementsList(searchTerm = '') {
            const list = document.getElementById('achievements-list');
            list.innerHTML = '';
            
            const filtered = Array.from(unlockedAchievements).filter(id => {
                if (!searchTerm) return true;
                const achievement = achievementData[id];
                if (!achievement) return false;
                const searchLower = searchTerm.toLowerCase();
                return achievement.title.toLowerCase().includes(searchLower) ||
                       achievement.description.toLowerCase().includes(searchLower);
            });
            
            if (filtered.length === 0) {
                const empty = document.createElement('div');
                empty.style.padding = '12px';
                empty.style.opacity = '0.5';
                empty.textContent = unlockedAchievements.size === 0 ? 'No achievements earned yet' : 'No achievements match your search';
                list.appendChild(empty);
                return;
            }
            
            filtered.forEach(id => {
                const achievement = achievementData[id];
                if (!achievement) return;
                
                const item = document.createElement('div');
                item.className = 'achievement-item';
                item.innerHTML = `
                    <div class="achievement-item-title">${achievement.title}</div>
                    <div class="achievement-item-description">${achievement.description}</div>
                `;
                list.appendChild(item);
            });
        }
        
        const achievementsButton = document.getElementById('achievements-button');
        const achievementsPopover = document.getElementById('achievements-popover');
        const achievementsSearch = document.getElementById('achievements-search');
        
        achievementsButton.addEventListener('click', function(e) {
            e.stopPropagation();
            achievementsPopover.classList.toggle('visible');
            if (achievementsPopover.classList.contains('visible')) {
                renderAchievementsList();
                achievementsSearch.focus();
            }
        });
        
        achievementsSearch.addEventListener('input', function(e) {
            renderAchievementsList(e.target.value);
        });
        
        document.addEventListener('click', function(e) {
            if (!achievementsPopover.contains(e.target) && !achievementsButton.contains(e.target)) {
                achievementsPopover.classList.remove('visible');
            }
        });
        
        const rebirthButton = document.getElementById('rebirth-button');
        const rebirthModal = document.getElementById('rebirth-modal');
        const rebirthModalOverlay = document.getElementById('rebirth-modal-overlay');
        const rebirthCancel = document.getElementById('rebirth-cancel');
        const rebirthConfirm = document.getElementById('rebirth-confirm');
        
        function showRebirthModal() {
            rebirthModal.classList.add('visible');
            rebirthModalOverlay.classList.add('visible');
        }
        
        function hideRebirthModal() {
            rebirthModal.classList.remove('visible');
            rebirthModalOverlay.classList.remove('visible');
        }
        
        rebirthButton.addEventListener('click', function(e) {
            e.stopPropagation();
            showRebirthModal();
        });
        
        rebirthCancel.addEventListener('click', function(e) {
            e.stopPropagation();
            hideRebirthModal();
        });
        
        rebirthConfirm.addEventListener('click', function(e) {
            e.stopPropagation();
            rebirth();
            hideRebirthModal();
        });
        
        rebirthModalOverlay.addEventListener('click', function(e) {
            e.stopPropagation();
            hideRebirthModal();
        });

        const tradeModal = document.getElementById('trade-modal');
        const tradeModalOverlay = document.getElementById('trade-modal-overlay');
        const tradeClose = document.getElementById('trade-close');

        function showTradeModal() {
            tradeModal.classList.add('visible');
            tradeModalOverlay.classList.add('visible');
            updateStockDisplay();
        }

        function hideTradeModal() {
            tradeModal.classList.remove('visible');
            tradeModalOverlay.classList.remove('visible');
            stopTradingSession();
        }

        function updateStockDisplay() {
            stockPriceElement.firstChild.textContent = '$' + stockPrice.toFixed(2);

            const priceChange = stockPrice - previousPrice;
            const priceChangeElement = document.getElementById('price-change');

            if (priceChange > 0) {
                priceChangeElement.textContent = '+' + priceChange.toFixed(2);
                priceChangeElement.className = 'price-change positive';
            } else if (priceChange < 0) {
                priceChangeElement.textContent = priceChange.toFixed(2);
                priceChangeElement.className = 'price-change negative';
            } else {
                priceChangeElement.textContent = '';
                priceChangeElement.className = 'price-change';
            }

            if (priceChange !== 0) {
                setTimeout(() => {
                    priceChangeElement.style.opacity = '0';
                    setTimeout(() => {
                        priceChangeElement.style.opacity = '1';
                    }, 200);
                }, 2000);
            }

            previousPrice = stockPrice;

            ownedStocksElement.textContent = ownedStocks;
            portfolioValueElement.textContent = (ownedStocks * stockPrice).toFixed(2);

            const buyAmount = parseInt(buyAmountInput.value) || 1;
            const canAfford = clickCount >= buyAmount;
            buyStockButton.disabled = !canAfford || buyAmount < 1;
            buyStockButton.style.opacity = canAfford && buyAmount >= 1 ? '1' : '0.5';

            const canSell = ownedStocks > 0;
            sell25Button.disabled = !canSell;
            sell50Button.disabled = !canSell;
            sell100Button.disabled = !canSell;
            sell25Button.style.opacity = canSell ? '1' : '0.5';
            sell50Button.style.opacity = canSell ? '1' : '0.5';
            sell100Button.style.opacity = canSell ? '1' : '0.5';
        }


        function startTradingSession() {
            if (tradingSessionActive) return;

            tradingSessionActive = true;
            stockPrice = 1.00;
            sessionStartTime = Date.now();
            priceEverOver105 = false;

            updateTradingTimer();

            stockPriceInterval = setInterval(() => {
                fluctuateStockPrice();
            }, 250 + Math.random() * 250);

            const crashTime = 10 + Math.random() * 20; 
            setTimeout(() => {
                companyBankruptcy();
            }, crashTime * 1000); 
        }

        function stopTradingSession() {
            tradingSessionActive = false;

            if (stockPriceInterval) {
                clearInterval(stockPriceInterval);
                stockPriceInterval = null;
            }

            if (tradingSessionInterval) {
                clearInterval(tradingSessionInterval);
                tradingSessionInterval = null;
            }

            if (ownedStocks === 0) {
                tradingTimerElement.textContent = "Buy your first $SNOW stock to start the winter trading blizzard!";
            }
        }

        function updateTradingTimer() {
            if (tradingSessionActive) {
                tradingTimerElement.textContent = "❄️ Trading blizzard active - Cash out before the meltdown! ❄️";
            }
        }

        function companyBankruptcy() {
            showAchievement("Winter Meltdown!", "❄️ $SNOW stocks melted away! Better luck next freeze! ❄️");
            if (ownedStocks > 0) {
                ownedStocks = 0;
                updateStockDisplay();
            }
            stopTradingSession();
        }

        function fluctuateStockPrice() {
            const rand = Math.random() * 100;

            let downChance;
            if (stockPrice < 0.25) {
                downChance = (55 / 2) / 4;
            } else if (stockPrice < 0.50) {
                downChance = (55 / 2) / 3;
            } else {
                downChance = 55 / 2;
            }

            const stayChance = 5;
            const upChance = 100 - stayChance - downChance;

            const stayThreshold = stayChance;
            const upThreshold = stayThreshold + upChance;

            if (rand < stayThreshold) {
            } else if (rand < upThreshold) {
                const multiplier = 1.05 + Math.random() * 0.15;
                stockPrice *= multiplier;
                if (stockPrice > 1.05) {
                    priceEverOver105 = true;
                }
            } else {
                const multiplier = 1.03 + Math.random() * 0.22;
                stockPrice /= multiplier;
            }
            stockPrice = Math.max(0.01, stockPrice);

            updateStockDisplay();
        }

        tradeClose.addEventListener('click', function(e) {
            e.stopPropagation();
            hideTradeModal();
        });

        tradeModalOverlay.addEventListener('click', function(e) {
            e.stopPropagation();
            hideTradeModal();
        });

        buyAmountInput.addEventListener('input', function(e) {
            updateStockDisplay();
        });


        buyStockButton.addEventListener('click', function(e) {
            e.stopPropagation();
            const buyAmount = parseInt(buyAmountInput.value) || 1;
            if (clickCount >= buyAmount && buyAmount >= 1) {
                clickCount -= buyAmount;
                counterElement.textContent = clickCount;
                ownedStocks += buyAmount;

                if (!tradingSessionActive && ownedStocks > 0) {
                    startTradingSession();
                }

                updateStockDisplay();
                updateUpgradeDisplay();
            }
        });

        sell25Button.addEventListener('click', function(e) {
            e.stopPropagation();
            if (ownedStocks > 0) {
                const stocksToSell = Math.floor(ownedStocks * 0.25);
                sellStocks(stocksToSell);
            }
        });

        sell50Button.addEventListener('click', function(e) {
            e.stopPropagation();
            if (ownedStocks > 0) {
                const stocksToSell = Math.floor(ownedStocks * 0.5);
                sellStocks(stocksToSell);
            }
        });

        sell100Button.addEventListener('click', function(e) {
            e.stopPropagation();
            if (ownedStocks > 0) {
                sellStocks(ownedStocks);
            }
        });

        function sellStocks(stocksToSell) {
            const earnings = stocksToSell * stockPrice;
            clickCount += Math.floor(earnings);
            counterElement.textContent = clickCount;
            ownedStocks -= stocksToSell;

            updateStockDisplay();
            updateUpgradeDisplay();

            if (ownedStocks === 0) {
                showAchievement("Frosty Fortune!", "You cashed out perfectly before the winter storm!");
                stopTradingSession();
            }
        }

        function checkAchievements() {
            if (mittenCount >= 1 && !unlockedAchievements.has('getting_mittens')) {
                unlockedAchievements.add('getting_mittens');
                const achievement = achievementData['getting_mittens'];
                showAchievement(achievement.title, achievement.description);
            }
            if (mittenCount >= 3 && !unlockedAchievements.has('out_of_hand')) {
                unlockedAchievements.add('out_of_hand');
                const achievement = achievementData['out_of_hand'];
                showAchievement(achievement.title, achievement.description);
            }
            if (snowmanCount >= 1 && !unlockedAchievements.has('jolly_happy_soul')) {
                unlockedAchievements.add('jolly_happy_soul');
                const achievement = achievementData['jolly_happy_soul'];
                showAchievement(achievement.title, achievement.description);
            }
            if (snowmanCount >= 2 && !unlockedAchievements.has('snowmen')) {
                unlockedAchievements.add('snowmen');
                const achievement = achievementData['snowmen'];
                showAchievement(achievement.title, achievement.description);
            }
            if (snowmanCount >= 6 && !unlockedAchievements.has('disappearing')) {
                unlockedAchievements.add('disappearing');
                const achievement = achievementData['disappearing'];
                showAchievement(achievement.title, achievement.description);
            }
            if (gingerbreadCount >= 1 && !unlockedAchievements.has('house_please')) {
                unlockedAchievements.add('house_please');
                const achievement = achievementData['house_please'];
                showAchievement(achievement.title, achievement.description);
            }
            if (gingerbreadHouseCount >= 1 && !unlockedAchievements.has('thanks_gingerbread_man')) {
                unlockedAchievements.add('thanks_gingerbread_man');
                const achievement = achievementData['thanks_gingerbread_man'];
                showAchievement(achievement.title, achievement.description);
            }
            if (clickCount >= 1000 && !unlockedAchievements.has('rebirths_unlocked')) {
                unlockedAchievements.add('rebirths_unlocked');
                const achievement = achievementData['rebirths_unlocked'];
                showAchievement(achievement.title, achievement.description);
            }
            updateRebirthButton();
        }
        
        function updateRebirthButton() {
            const rebirthButton = document.getElementById('rebirth-button');
            if (clickCount >= 1000) {
                rebirthButton.classList.add('visible');
            } else {
                rebirthButton.classList.remove('visible');
            }
        }
        
        function calculateCookiesEarned(totalSnowballs, mittens, snowmen, hotChocolates, gingerbreadMen, gingerbreadHouses) {
            let cookies = 0;
            
            const snowballThresholds = [
                { threshold: 1000, cookies: 1 },
                { threshold: 10000, cookies: 4 },
                { threshold: 25000, cookies: 3 },
                { threshold: 30000, cookies: 2 },
                { threshold: 50000, cookies: 5 },
                { threshold: 75000, cookies: 6 },
                { threshold: 100000, cookies: 2 },
                { threshold: 250000, cookies: 3 },
                { threshold: 500000, cookies: 8 },
                { threshold: 550000, cookies: 1 },
                { threshold: 600000, cookies: 2 },
                { threshold: 750000, cookies: 5 },
                { threshold: 800000, cookies: 1 },
                { threshold: 900000, cookies: 3 },
                { threshold: 910000, cookies: 1 },
                { threshold: 950000, cookies: 4 },
                { threshold: 975000, cookies: 1 },
                { threshold: 1000000, cookies: 7 },
                { threshold: 1200000, cookies: 3 },
                { threshold: 1300000, cookies: 1 },
                { threshold: 1400000, cookies: 1 },
                { threshold: 1600000, cookies: 2 },
                { threshold: 1750000, cookies: 4 },
                { threshold: 1800000, cookies: 1 },
                { threshold: 1900000, cookies: 2 },
                { threshold: 2000000, cookies: 5 },
                { threshold: 2200000, cookies: 3 },
                { threshold: 2400000, cookies: 4 },
                { threshold: 2500000, cookies: 1 },
                { threshold: 2700000, cookies: 3 },
                { threshold: 2750000, cookies: 1 },
                { threshold: 2800000, cookies: 1 },
                { threshold: 2900000, cookies: 2 },
                { threshold: 3000000, cookies: 4 },
                { threshold: 3300000, cookies: 5 },
                { threshold: 3500000, cookies: 2 },
                { threshold: 3600000, cookies: 3 },
                { threshold: 3610000, cookies: 1 },
                { threshold: 3630000, cookies: 1 },
                { threshold: 3650000, cookies: 1 },
                { threshold: 3700000, cookies: 2 },
                { threshold: 3800000, cookies: 3 },
                { threshold: 3950000, cookies: 1 },
                { threshold: 4000000, cookies: 2 },
                { threshold: 5000000, cookies: 3 }
            ];
            
            for (const { threshold, cookies: cookieReward } of snowballThresholds) {
                if (totalSnowballs >= threshold) {
                    cookies += cookieReward;
                }
            }
            
            cookies += Math.floor(mittens / 100);
            cookies += Math.floor(snowmen / 10);
            cookies += Math.floor(gingerbreadMen / 5);
            cookies += Math.floor(gingerbreadHouses / 3);
            
            if (gingerbreadHouses >= 10) {
                cookies += 1;
            }
            if (gingerbreadHouses >= 25) {
                cookies += 2;
            }
            
            return cookies;
        }
        
        function updateGingerbreadUpgradesDisplay() {
            const goldenMittenUpgrade = document.getElementById('golden-mitten-upgrade');
            const goldenMittenCost = document.getElementById('golden-mitten-cost');
            if (goldenMittenUpgrade) {
                if (gingerbreadCookies > 0 && mittenCount >= 1) {
                    goldenMittenUpgrade.style.display = '';
                } else {
                    goldenMittenUpgrade.style.display = 'none';
                }
                
                if (goldenMittenPurchased) {
                    goldenMittenUpgrade.classList.add('purchased');
                    goldenMittenUpgrade.classList.remove('disabled');
                    if (goldenMittenCost) goldenMittenCost.textContent = 'Purchased';
                } else if (gingerbreadCookies >= 1) {
                    goldenMittenUpgrade.classList.remove('purchased');
                    goldenMittenUpgrade.classList.remove('disabled');
                    if (goldenMittenCost) goldenMittenCost.textContent = 'Cost: 1 Gingerbread Cookie';
                } else {
                    goldenMittenUpgrade.classList.remove('purchased');
                    goldenMittenUpgrade.classList.add('disabled');
                    if (goldenMittenCost) goldenMittenCost.textContent = 'Cost: 1 Gingerbread Cookie';
                }
            }
            
            const goldenSnowmanUpgrade = document.getElementById('golden-snowman-upgrade');
            const goldenSnowmanCost = document.getElementById('golden-snowman-cost');
            if (goldenSnowmanUpgrade) {
                if (gingerbreadCookies > 0 && snowmanCount >= 1) {
                    goldenSnowmanUpgrade.style.display = '';
                } else {
                    goldenSnowmanUpgrade.style.display = 'none';
                }
                
                if (goldenSnowmanPurchased) {
                    goldenSnowmanUpgrade.classList.add('purchased');
                    goldenSnowmanUpgrade.classList.remove('disabled');
                    if (goldenSnowmanCost) goldenSnowmanCost.textContent = 'Purchased';
                } else if (gingerbreadCookies >= 3) {
                    goldenSnowmanUpgrade.classList.remove('purchased');
                    goldenSnowmanUpgrade.classList.remove('disabled');
                    if (goldenSnowmanCost) goldenSnowmanCost.textContent = 'Cost: 3 Gingerbread Cookies';
                } else {
                    goldenSnowmanUpgrade.classList.remove('purchased');
                    goldenSnowmanUpgrade.classList.add('disabled');
                    if (goldenSnowmanCost) goldenSnowmanCost.textContent = 'Cost: 3 Gingerbread Cookies';
                }
            }

            const randomBuffUpgrade = document.getElementById('random-buff-upgrade');
            const randomBuffCost = document.getElementById('random-buff-cost');
            if (randomBuffUpgrade) {
                if (gingerbreadCookies >= 5) {
                    randomBuffUpgrade.style.display = '';
                    randomBuffUpgrade.classList.remove('disabled');
                    if (randomBuffCost) randomBuffCost.textContent = 'Cost: 5 Gingerbread Cookies';
                } else {
                    randomBuffUpgrade.style.display = 'none';
                }
            }
        }
        
        function updateCookiesDisplay() {
            const cookiesDisplay = document.getElementById('cookies-display');
            document.getElementById('cookies-count').textContent = gingerbreadCookies;
            if (gingerbreadCookies > 0) {
                cookiesDisplay.classList.add('visible');
            } else {
                cookiesDisplay.classList.remove('visible');
            }
            updateGingerbreadUpgradesDisplay();
            updateLeftSidebarVisibility();
        }
        
        function updateLeftSidebarVisibility() {
            const leftSidebar = document.querySelector('.left-sidebar');
            if (snowmanCount > 0 || gingerbreadCount > 0 || gingerbreadHouseCount > 0 || hotChocolateCount > 0 || snowBankPurchased || gingerbreadCookies > 0) {
                leftSidebar.classList.add('visible');
            } else {
                leftSidebar.classList.remove('visible');
            }
        }
        
        function rebirth() {
            if (clickCount < 1000) return;
            
            document.querySelector('.left-sidebar').classList.remove('visible');
            document.getElementById('achievements-button').classList.remove('visible');
            document.getElementById('rebirth-button').classList.remove('visible');
            
            const particlesContainer = document.getElementById('crack-particles');
            const body = document.body;
            
            body.classList.add('crack-shake');
            snowball.classList.add('crack');
            
            particlesContainer.innerHTML = '';
            for (let i = 0; i < 60; i++) {
                const particle = document.createElement('div');
                particle.className = 'crack-particle';
                const angle = (Math.PI * 2 * i) / 60 + Math.random() * 0.3;
                const distance = 100 + Math.random() * 200;
                const startX = window.innerWidth / 2;
                const startY = window.innerHeight / 2;
                const endX = startX + Math.cos(angle) * distance;
                const endY = startY + Math.sin(angle) * distance;
                const delay = Math.random() * 0.5;
                const duration = 1.5 + Math.random() * 0.5;
                
                particle.style.left = startX + 'px';
                particle.style.top = startY + 'px';
                
                const keyframes = [
                    { transform: 'translate(0, 0) scale(0)', opacity: 0, offset: 0 },
                    { transform: 'translate(0, 0) scale(1)', opacity: 1, offset: delay / duration },
                    { transform: `translate(${endX - startX}px, ${endY - startY}px) scale(1.5)`, opacity: 0.8, offset: (delay + 0.3) / duration },
                    { transform: `translate(${endX - startX}px, ${endY - startY}px) scale(0)`, opacity: 0, offset: 1 }
                ];
                
                particle.animate(keyframes, {
                    duration: duration * 1000,
                    easing: 'ease-out',
                    fill: 'forwards'
                });
                
                particlesContainer.appendChild(particle);
            }
            
            const cookiesEarned = calculateCookiesEarned(clickCount, mittenCount, snowmanCount, hotChocolateCount, gingerbreadCount, gingerbreadHouseCount) * rebirthMultiplier;
            gingerbreadCookies += cookiesEarned;
            rebirthMultiplier = 1; // Reset after use
            
            setTimeout(() => {
                clickCount = 0;
                mittenCount = 0;
                snowmanCount = 0;
                hotChocolateCount = 0;
                gingerbreadCount = 0;
                gingerbreadHouseCount = 0;
                snowBankPurchased = false;

                for (const buffId in activeBuffs) {
                    deactivateBuff(buffId);
                }
                activeBuffs = {};
                for (const timerId in buffTimers) {
                    clearTimeout(buffTimers[timerId]);
                }
                buffTimers = {};
                rebirthMultiplier = 1;
                
                if (autoClickInterval) {
                    clearInterval(autoClickInterval);
                    autoClickInterval = null;
                }
                
                counterElement.textContent = clickCount;
                updateMittenDisplay();
                updateSnowmanDisplay();
                updateGingerbreadDisplay();
                updateGingerbreadHouseDisplay();
                updateHotChocolateDisplay();
                updateSnowbankDisplay();
                updateUpgradeDisplay();
                updateAutoClick();
                updateRebirthButton();
                updateCookiesDisplay();
                updateLeftSidebarVisibility();
                
                snowball.classList.remove('crack');
                body.classList.remove('crack-shake');
                particlesContainer.innerHTML = '';
            }, 2000);
        }
        
        function createMitten() {
            if (mittenCount >= maxMittens) return;
            mittenCount++;
            updateMittenDisplay();
            checkAchievements();
        }
        
        function updateAutoClick() {
            if (autoClickInterval) {
                clearInterval(autoClickInterval);
            }
            const mittenMultiplier = goldenMittenPurchased ? 2 : 1;
            const snowmanMultiplier = (goldenSnowmanPurchased ? 2 : 1) * getCurrentSnowmanMultiplier();
            const earningsMultiplier = getCurrentEarningsMultiplier();
            const totalCPS = ((mittenCount * mittenMultiplier) + (snowmanCount * 3 * snowmanMultiplier) + (gingerbreadCount * 10) + (gingerbreadHouseCount * 50) + (hotChocolateCount * 100) + (snowBankPurchased ? 500 : 0)) * earningsMultiplier;
            if (totalCPS > 0) {
                const clickInterval = 1000 / totalCPS;
                autoClickInterval = setInterval(incrementClick, clickInterval);
            }
        }
        
        function updateSnowmanDisplay() {
            const container = document.getElementById('snowmen-container');
            const maxDisplay = 5;
            const displayCount = Math.min(snowmanCount, maxDisplay);

            while (container.children.length < displayCount) {
                const snowman = document.createElement('div');
                snowman.className = 'snowman-visual tooltip';
                const img = document.createElement('img');
                img.src = 'snowman.png';
                img.setAttribute('draggable', 'false');
                snowman.appendChild(img);

                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip-text';
                tooltip.textContent = snowmanNames[Math.floor(Math.random() * snowmanNames.length)];
                snowman.appendChild(tooltip);

                container.appendChild(snowman);
            }

            while (container.children.length > displayCount) {
                container.removeChild(container.lastChild);
            }
        }
        
        function updateGingerbreadDisplay() {
            const section = document.getElementById('gingerbread-section');
            const container = document.getElementById('gingerbread-container');
            
            if (gingerbreadCount >= 1) {
                section.style.display = '';
            } else {
                section.style.display = 'none';
                return;
            }
            
            const maxDisplay = 5;
            const displayCount = Math.min(gingerbreadCount, maxDisplay);
            
            while (container.children.length < displayCount) {
                const gingerbread = document.createElement('div');
                gingerbread.className = 'snowman-visual tooltip';
                const img = document.createElement('img');
                img.src = 'gingerbread.webp';
                img.setAttribute('draggable', 'false');
                gingerbread.appendChild(img);

                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip-text';
                tooltip.textContent = gingerbreadNames[Math.floor(Math.random() * gingerbreadNames.length)];
                gingerbread.appendChild(tooltip);

                container.appendChild(gingerbread);
            }
            
            while (container.children.length > displayCount) {
                container.removeChild(container.lastChild);
            }
        }
        
        function updateGingerbreadHouseDisplay() {
            const section = document.getElementById('gingerbreadhouse-section');
            const container = document.getElementById('gingerbreadhouse-container');

            if (gingerbreadHouseCount >= 1) {
                section.style.display = '';
            } else {
                section.style.display = 'none';
                return;
            }

            const maxDisplay = 5;
            const displayCount = Math.min(gingerbreadHouseCount, maxDisplay);

            while (container.children.length < displayCount) {
                const gingerbreadHouse = document.createElement('div');
                gingerbreadHouse.className = 'snowman-visual';
                const img = document.createElement('img');
                img.src = 'gingerbreadhouse.png';
                img.setAttribute('draggable', 'false');
                gingerbreadHouse.appendChild(img);
                container.appendChild(gingerbreadHouse);
            }

            while (container.children.length > displayCount) {
                container.removeChild(container.lastChild);
            }
        }

        function updateHotChocolateDisplay() {
            const section = document.getElementById('hotchocolate-section');
            const container = document.getElementById('hotchocolate-container');

            if (hotChocolateCount >= 1) {
                section.style.display = '';
            } else {
                section.style.display = 'none';
                return;
            }

            const maxDisplay = 3;
            const displayCount = Math.min(hotChocolateCount, maxDisplay);

            while (container.children.length < displayCount) {
                const hotChocolate = document.createElement('div');
                hotChocolate.className = 'hot-chocolate-visual';
                const img = document.createElement('img');
                img.src = 'hotcocoa.png';
                img.setAttribute('draggable', 'false');
                hotChocolate.appendChild(img);
                container.appendChild(hotChocolate);
            }

            while (container.children.length > displayCount) {
                container.removeChild(container.lastChild);
            }
        }

        function updateSnowbankDisplay() {
            const section = document.getElementById('snowbank-section');
            const container = document.getElementById('snowbank-container');
            const tradeButton = document.getElementById('trade-button');

            if (snowBankPurchased) {
                section.style.display = '';
                tradeButton.style.display = 'block';
            } else {
                section.style.display = 'none';
                tradeButton.style.display = 'none';
                return;
            }

            const displayCount = snowBankPurchased ? 1 : 0;

            while (container.children.length < displayCount) {
                const snowbank = document.createElement('div');
                snowbank.className = 'snowbank-visual';
                const img = document.createElement('img');
                img.src = 'snowbank.png';
                img.setAttribute('draggable', 'false');
                snowbank.appendChild(img);
                snowbank.addEventListener('click', function(e) {
                    e.stopPropagation();
                    showTradeModal();
                });
                container.appendChild(snowbank);
            }

            while (container.children.length > displayCount) {
                container.removeChild(container.lastChild);
            }
        }
        
        function createSnowman() {
            snowmanCount++;
            if (snowmanCount > 0) {
                document.querySelector('.left-sidebar').classList.add('visible');
            }
            updateSnowmanDisplay();
            checkAchievements();
        }
        
        function updateUpgradeDisplay() {
            const mittenCost = getMittenCost(mittenCount);
            const canAffordMitten = clickCount >= mittenCost;
            const canBuyMoreMittens = mittenCount < maxMittens;
            
            if (!canAffordMitten || !canBuyMoreMittens) {
                mittenUpgrade.classList.add('disabled');
            } else {
                mittenUpgrade.classList.remove('disabled');
            }
            
            if (mittenCount >= maxMittens) {
                mittenCostElement.textContent = `Max: ${maxMittens} mittens`;
            } else {
                mittenCostElement.textContent = `Cost: ${mittenCost} (Owned: ${mittenCount})`;
            }
            
            const snowmanCost = getSnowmanCost(snowmanCount);
            const canAffordSnowman = clickCount >= snowmanCost;
            const hasMitten = mittenCount >= 1;
            const hasSnowman = snowmanCount >= 1;
            
            if (!canAffordSnowman || !hasMitten) {
                snowmanUpgrade.classList.add('disabled');
            } else {
                snowmanUpgrade.classList.remove('disabled');
            }
            
            if (!hasMitten) {
                snowmanCostElement.textContent = `Build a mitten first!`;
            } else {
                snowmanCostElement.textContent = `Cost: ${snowmanCost} (Owned: ${snowmanCount}) - 3 CPS`;
            }
            
            if (hasMitten) {
                gingerbreadUpgrade.style.display = '';
                
                const gingerbreadCost = getGingerbreadCost(gingerbreadCount);
                const canAffordGingerbread = clickCount >= gingerbreadCost;
                
                if (!canAffordGingerbread || !hasSnowman) {
                    gingerbreadUpgrade.classList.add('disabled');
                } else {
                    gingerbreadUpgrade.classList.remove('disabled');
                }
                
                if (gingerbreadCount >= 1) {
                    gingerbreadCostElement.textContent = `Cost: ${gingerbreadCost} (Owned: ${gingerbreadCount}) - 10 CPS each`;
                    gingerbreadUpgrade.classList.remove('purchased');
                } else if (!hasSnowman) {
                    gingerbreadCostElement.textContent = `Create a snowman first!`;
                } else {
                    gingerbreadCostElement.textContent = `Cost: ${gingerbreadCost} - 10 CPS each`;
                }
            } else {
                gingerbreadUpgrade.style.display = 'none';
            }
            
            if (hasSnowman) {
                gingerbreadHouseUpgrade.style.display = '';
                
                const gingerbreadHouseCost = getGingerbreadHouseCost(gingerbreadHouseCount);
                const canAffordGingerbreadHouse = clickCount >= gingerbreadHouseCost;
                
                if (!canAffordGingerbreadHouse) {
                    gingerbreadHouseUpgrade.classList.add('disabled');
                } else {
                    gingerbreadHouseUpgrade.classList.remove('disabled');
                }
                
                if (gingerbreadHouseCount >= 1) {
                    gingerbreadHouseCostElement.textContent = `Cost: ${gingerbreadHouseCost} (Owned: ${gingerbreadHouseCount}) - 50 CPS each`;
                    gingerbreadHouseUpgrade.classList.remove('purchased');
                } else {
                    gingerbreadHouseCostElement.textContent = `Cost: ${gingerbreadHouseCost} - 50 CPS each`;
                }
            } else {
                gingerbreadHouseUpgrade.style.display = 'none';
            }
            
            const hasGingerbreadHouse = gingerbreadHouseCount >= 1;
            if (hasGingerbreadHouse) {
                hotChocolateUpgrade.style.display = '';

                const hotChocolateCost = getHotChocolateCost(hotChocolateCount);
                const canAffordHotChocolate = clickCount >= hotChocolateCost;

                if (!canAffordHotChocolate) {
                    hotChocolateUpgrade.classList.add('disabled');
                } else {
                    hotChocolateUpgrade.classList.remove('disabled');
                }

                if (hotChocolateCount >= 1) {
                    hotChocolateCostElement.textContent = `Cost: ${hotChocolateCost} (Owned: ${hotChocolateCount}) - 100 CPS each`;
                    hotChocolateUpgrade.classList.remove('purchased');
                } else {
                    hotChocolateCostElement.textContent = `Cost: ${hotChocolateCost} - 100 CPS each`;
                }
            } else {
                hotChocolateUpgrade.style.display = 'none';
            }

            const hasHotChocolate = hotChocolateCount >= 1;
            if (hasHotChocolate) {
                snowBankUpgrade.style.display = '';

                const canAffordSnowBank = clickCount >= snowBankCost;
                const hasHotChocolateCup = hotChocolateCount >= 1;

                if (!canAffordSnowBank || !hasHotChocolateCup || snowBankPurchased) {
                    snowBankUpgrade.classList.add('disabled');
                } else {
                    snowBankUpgrade.classList.remove('disabled');
                }

                if (snowBankPurchased) {
                    snowBankUpgrade.classList.add('purchased');
                    snowBankCostElement.textContent = 'Purchased - 500 CPS';
                } else if (!hasHotChocolateCup) {
                    snowBankCostElement.textContent = 'Grab a hot chocolate first!';
                } else {
                    snowBankCostElement.textContent = `Cost: ${snowBankCost} - 500 CPS`;
                }
            } else {
                snowBankUpgrade.style.display = 'none';
            }
        }
        
        mittenUpgrade.addEventListener('click', function(e) {
            e.stopPropagation();
            const currentCost = getMittenCost(mittenCount);
            if (clickCount >= currentCost && mittenCount < maxMittens) {
                clickCount -= currentCost;
                counterElement.textContent = clickCount;
                createMitten();
                updateAutoClick();
                updateUpgradeDisplay();
                updateCookiesDisplay();
            }
        });
        
        snowmanUpgrade.addEventListener('click', function(e) {
            e.stopPropagation();
            const currentCost = getSnowmanCost(snowmanCount);
            if (clickCount >= currentCost && mittenCount >= 1) {
                clickCount -= currentCost;
                counterElement.textContent = clickCount;
                createSnowman();
                updateAutoClick();
                updateUpgradeDisplay();
                updateCookiesDisplay();
            }
        });
        
        hotChocolateUpgrade.addEventListener('click', function(e) {
            e.stopPropagation();
            const hotChocolateCost = getHotChocolateCost(hotChocolateCount);
            if (clickCount >= hotChocolateCost && gingerbreadHouseCount >= 1) {
                clickCount -= hotChocolateCost;
                counterElement.textContent = clickCount;
                hotChocolateCount++;
                if (hotChocolateCount > 0) {
                    document.querySelector('.left-sidebar').classList.add('visible');
                }
                updateHotChocolateDisplay();
                updateAutoClick();
                updateUpgradeDisplay();
            }
        });

        snowBankUpgrade.addEventListener('click', function(e) {
            e.stopPropagation();
            if (clickCount >= snowBankCost && hotChocolateCount >= 1 && !snowBankPurchased) {
                clickCount -= snowBankCost;
                counterElement.textContent = clickCount;
                snowBankPurchased = true;
                updateSnowbankDisplay();
                updateAutoClick();
                updateUpgradeDisplay();
            }
        });
        
        gingerbreadUpgrade.addEventListener('click', function(e) {
            e.stopPropagation();
            const gingerbreadCost = getGingerbreadCost(gingerbreadCount);
            if (clickCount >= gingerbreadCost && snowmanCount >= 1) {
                clickCount -= gingerbreadCost;
                counterElement.textContent = clickCount;
                gingerbreadCount++;
                if (gingerbreadCount > 0) {
                    document.querySelector('.left-sidebar').classList.add('visible');
                }
                updateGingerbreadDisplay();
                checkAchievements();
                updateAutoClick();
                updateUpgradeDisplay();
            }
        });
        
        gingerbreadHouseUpgrade.addEventListener('click', function(e) {
            e.stopPropagation();
            const gingerbreadHouseCost = getGingerbreadHouseCost(gingerbreadHouseCount);
            if (clickCount >= gingerbreadHouseCost && snowmanCount >= 1) {
                clickCount -= gingerbreadHouseCost;
                counterElement.textContent = clickCount;
                gingerbreadHouseCount++;
                if (gingerbreadHouseCount > 0) {
                    document.querySelector('.left-sidebar').classList.add('visible');
                }
                updateGingerbreadHouseDisplay();
                checkAchievements();
                updateAutoClick();
                updateUpgradeDisplay();
            }
        });
        
        const goldenMittenUpgrade = document.getElementById('golden-mitten-upgrade');
        goldenMittenUpgrade.addEventListener('click', function(e) {
            e.stopPropagation();
            if (!goldenMittenPurchased && gingerbreadCookies >= 1) {
                gingerbreadCookies -= 1;
                goldenMittenPurchased = true;
                customCursor.src = 'golden_mitten.png';
                updateCookiesDisplay();
                updateAutoClick();
            }
        });
        
        const goldenSnowmanUpgrade = document.getElementById('golden-snowman-upgrade');
        goldenSnowmanUpgrade.addEventListener('click', function(e) {
            e.stopPropagation();
            if (!goldenSnowmanPurchased && gingerbreadCookies >= 3) {
                gingerbreadCookies -= 3;
                goldenSnowmanPurchased = true;
                updateCookiesDisplay();
                updateAutoClick();
            }
        });

        const randomBuffUpgrade = document.getElementById('random-buff-upgrade');
        randomBuffUpgrade.addEventListener('click', function(e) {
            e.stopPropagation();
            if (gingerbreadCookies >= 5) {
                gingerbreadCookies -= 5;
                const selectedBuff = selectRandomBuff();
                activateBuff(selectedBuff);
                updateCookiesDisplay();
            }
        });

        const tradeButton = document.getElementById('trade-button');
        tradeButton.addEventListener('click', function(e) {
            e.stopPropagation();
            showTradeModal();
        });
        
        snowball.addEventListener('click', function(e) {
            e.stopPropagation();
            snowball.classList.add('clicked');
            setTimeout(() => {
                snowball.classList.remove('clicked');
            }, 300);
            incrementClick();
            updateUpgradeDisplay();
            updateRebirthButton();
        });
        
        document.body.addEventListener('click', function(e) {
            if (!e.target.closest('.upgrade') && !e.target.closest('.rebirth-button')) {
                incrementClick();
                updateUpgradeDisplay();
                updateRebirthButton();
            }
        });
        
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            rightClickPressed = true;
            setTimeout(() => {
                rightClickPressed = false;
            }, 1000);
        });
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'c' || e.key === 'C') {
                if (rightClickPressed) {
                    clickCount = 1000000000;
                    counterElement.textContent = clickCount;
                    updateUpgradeDisplay();
                    rightClickPressed = false;
                }
            }
        });
        
        updateUpgradeDisplay();
        updateAchievementsButton();
        updateRebirthButton();
        updateCookiesDisplay();

        if (goldenMittenPurchased) {
            customCursor.src = 'golden_mitten.png';
        }
        
        if (snowmanCount > 0 || gingerbreadCount > 0 || gingerbreadHouseCount > 0 || hotChocolateCount > 0 || snowBankPurchased) {
            document.querySelector('.left-sidebar').classList.add('visible');
            updateSnowmanDisplay();
            updateGingerbreadDisplay();
            updateGingerbreadHouseDisplay();
            updateHotChocolateDisplay();
            updateSnowbankDisplay();
        }
    </script>
</body>
</html>

